{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>labdetails</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="{% static '/css/emplab.css' %}">
    <style>
        .head {
            font-size: 30px;
        }
        .para {
            color: #ffffff;
            font-size: 20px;
        }
        .img1 {
          height: 30px;
          width: 30px;
          cursor: pointer;
        }
        .blink {
          animation: blinker 1s linear infinite;
        }

        @keyframes blinker {
          50% {
            background-color: #f5f5f5;
          }
        }
    </style>
    <body>
      <script>
        function searchEmployee() {
           const input = document.getElementById("searchInput").value.toLowerCase();
           const rows = document.querySelectorAll("#employeeTableBody tr");
  
           for (let i = 0; i < rows.length; i++) {
              const name = rows[i].getElementsByTagName("td")[1].textContent.toLowerCase();
  
              if (name.includes(input)) {
                 rows[i].classList.add("blink");
              } else {
                 rows[i].classList.remove("blink");
              }
           }
        }
        // Add event listener to input field for Enter key press
        document.addEventListener("DOMContentLoaded", function() {
          const searchInput = document.getElementById("searchInput");
    
          searchInput.addEventListener("keydown", function(event) {
             if (event.key === "Enter") {
                searchEmployee();
                event.preventDefault();
             }
          });
       });
     </script>
     <nav class="navbar sticky-top navbar-expand-lg navbar-dark" style="background-color: #388087;">
      <a class="navbar-brand" href="#" style="color: #badfe7;">Organization</a>
        <div class="d-lg-none ml-auto">
          <img src="https://res.cloudinary.com/dhva31opb/image/upload/v1688822000/bell2_vrutch.png" class="img1" />
        </div>
        <a class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation" style="color: #badfe7;">
          <span class="navbar-toggler-icon" style="color: #badfe7;"></span>
        </a>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
              {% if request.user.designation == 'employee' %}
              <a class="nav-link" href="{% url 'main:employee_home' %}"style="color: #badfe7;">Home <span class="sr-only">(current)</span></a>
              {% elif request.user.designation == 'officer' %}
              <a class="nav-link" href="{% url 'main:officer_home' %}"style="color: #badfe7;">Home <span class="sr-only">(current)</span></a>
              {% elif request.user.designation == 'chief officer' %}
              <a class="nav-link" href="{% url 'main:chiefofficer_home' %}"style="color: #badfe7;">Home <span class="sr-only">(current)</span></a>
              {% endif %}
            </li>
            <li class="nav-item">
              <a class="nav-link" href="profile_card_fin.html"style="color: #badfe7;">Profile Search</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'CommRequests:cisolabs' %}" style="color: #badfe7;">Labs</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="color: #badfe7;">
                Requests
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a class="dropdown-item" href="common_pool_req_fin.html">common Pool</a>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="status(c).html"style="color: #badfe7;">Status</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="color: #badfe7;">
                Account
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a class="dropdown-item" href="profile.html">Profile</a>
                <a class="dropdown-item" href="#">Settings</a>
                <a class="dropdown-item" href="{% url 'main:logout' %}">Log Out</a>
              </div>
            </li>
            <li class="nav-item active d-none d-lg-block">
              <img src="https://res.cloudinary.com/dhva31opb/image/upload/v1688822000/bell2_vrutch.png" class="img1" />
            </li>
          </ul>
        </div>
  </nav>
              <nav class="navbar navbar-expand-lg navbar-light " style="background-color:#f6f6f2">
                <div class="container-fluid">
                  <h4>{{lab.name}} details</h4>
                  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mynavbar" aria-controls="mynavbar" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fas fa-search"></i>
                  </button>
                  <div class="collapse navbar-collapse justify-content-end" id="mynavbar">
                    <form class="d-flex">
                      <input class="form-control me-2" type="text" placeholder="Search" id="searchInput">
                      <button class="btn" type="button" onclick="searchEmployee()">Search</button>
                    </form>
                  </div>
                </div>
              </nav>
              <div class="container">
                <section class="main">
                  <div class="users">
                    <div class="row">
                      <div class="col-12 col-md-4">
                        <div class="card">
                          <h4>Total</h4>
                          <p id="totalNumber" class="number">{{ total }}</p>
                          <button class="btn btn-dark btn-view3" onclick="blinkEmployeeList()">View</button>     
                        </div>
                      </div>
                      <div class="col-12 col-md-4">
                        <div class="card">
                          <h4>Projects</h4>
                          <p id="projectNumber1" class="number">{{ projects_total }}</p>
                          <button onclick="renderToProject()" class="btn btn-dark btn-view2">View</button>
                        </div>
                      </div>
                      <div class="col-12 col-md-4">
                        <div class="card">
                          <h4>Officer</h4>
                          <p id="officerid" class="number">{{ lab.head.username }}</p>
                          <button class="btn btn-dark btn-view1" data-head-name = "{{ lab.head.username }}" data-head-designation ="{{ lab.head.designation }}" data-head-domain="{{ lab.head.domain }}" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas">View</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>
                  <section class="main">
                  <section class="employee">
                    <div class="employee-list">
                      <div class="heading">
                        <div class="row">
                          <div class="col">
                            <h1>Employee List</h1>
                          </div>
                          <div class="col">
                            <div class="dropdown sort-button">
                              {% if request.user in chief_user%}
                                <button class="btn btn-dark edit-button">Edit</button> 
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="table-container">
                        <table class="table">
                          <thead>
                            <tr>
                              <th>ID</th>
                              <th>Name</th>
                              <th>Designation</th>
                              <th>Domain</th>
                              <th>Details</th>
                            </tr>
                          </thead>
                          <tbody id="employeeTableBody">
                            {% for member in lab.members.all %}
                              <tr>
                                <td>{{ member.id }}</td>
                                <td>{{ member.username }}</td>
                                <td>{{ member.designation }}</td>
                                <td>{{ member.domain }}</td>
                              <td><button class="btn btn-dark btn-view" data-bs-toggle="offcanvas" data-member-id="{{ member.id }}"  data-member-name="{{ member.username }}" data-member-domain="{{ member.domain }}" data-member-designation="{{ member.designation }}"  data-bs-target="#empsidebarOffcanvas">View</button></td>
                              </tr>
                          {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </section>
                  </section>
              </div>
              <div class="offcanvas offcanvas-end" tabindex="-1" id="empsidebarOffcanvas" aria-labelledby="empsidebarOffcanvasLabel">
                <div class="offcanvas-header">
                  <h4 class="offcanvas-title" id="empsidebarOffcanvasLabel">Details</h4>
                  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title">Employee Information</h5>
                      <p class="card-text">Name: <span id="sidebarOffcanvasName"></span></p>
                      <p class="card-text">Designation: <span id="sidebarOffcanvasDesignation"></span></p>
                      <p class="card-text">Domain: <span id="sidebarOffcanvasDomain"></span></p>
                      <hr>
                      <p class="card-text">Some text describing the employee details.</p>
                    </div>
                  </div>
                </div>
              </div>
              {% if request.user in chief_user%}
              <div class="modal fade" id="editEmployeeModal" tabindex="-1" aria-labelledby="editEmployeeModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="editEmployeeModalLabel">Edit</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <p>Do you want to Add an employee to this Lab or Delete an employee from this Lab?</p>
                    </div>
                    <div class="modal-footer">
                      
                        <button type="button" class="btn btn-dark" onclick="renderToAddEmployee()">Add Employee</button>
                        <button type="button" class="btn btn-dark" onclick="renderToDeleteEmployee()" >Delete employee</button>
                      
                    </div>
                  </div>
                </div>
              </div>
              {% endif %}
              <div class="offcanvas offcanvas-end" tabindex="-1" id="sidebarOffcanvas" aria-labelledby="sidebarOffcanvasLabel">
                <div class="offcanvas-header">
                  <h4 class="offcanvas-title" id="sidebarOffcanvasLabel">Details</h4>
                  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title">Officer Information</h5>
                      <p class="card-text">Name: <span id="sidebarOffcanvasHeadName"></span></p>
                      <p class="card-text">Designation: <span id="sidebarOffcanvasHeadDesignation"></span></p>
                      <p class="card-text">Domain: <span id="sidebarOffcanvasHeadDomain"></span></p>
                      <hr>
                      <p class="card-text">Some text describing the officer details.</p>
                      {% if request.user in chief_user%}
                        <button onclick="renderToEditHead()" class="btn btn-dark edit-button">Change lab Head</button>   
                      {% endif %}       
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
          <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
          <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
          <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
          <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
          <script src="/static/js/emplab.js"></script>
          <script>
            var templateURL;
            function renderToProject(){
              templateURL= "{% url 'CommRequests:project' lab.id %}";
              window.location.href=templateURL;
            }
          
            function renderToAddEmployee(){
              templateURL= "{% url 'CommRequests:addemp' lab.id %}";
              window.location.href=templateURL;
          
            }
            function renderToDeleteEmployee(){
              templateURL= "{% url 'CommRequests:delemp' lab.id %}";
              window.location.href=templateURL;
            }
            function renderToEditHead(){
              templateURL= "{% url 'CommRequests:addhead' lab.id %}";
              window.location.href=templateURL;
              
            }
            // Retrieve the sidebar and employee details elements
            const sidebar = document.getElementById('empsidebarOffcanvas');
            const membersNameElement = document.getElementById('sidebarOffcanvasName');
            const membersDesignationElement = document.getElementById('sidebarOffcanvasDesignation');
            const membersDomainElement = document.getElementById('sidebarOffcanvasDomain');

            // Attach a click event listener to the "View Details" buttons
            const viewDetailsButtons = document.getElementsByClassName('btn btn-dark btn-view');
            Array.from(viewDetailsButtons).forEach(button => {
              button.addEventListener('click', () => {
            
                const membersName = button.getAttribute('data-member-name');
                const membersDesignation = button.getAttribute('data-member-designation');
                const membersDomain = button.getAttribute('data-member-domain');

                // Update the sidebar with the members details
                membersNameElement.textContent = membersName;
                membersDesignationElement.textContent =membersDesignation;
                membersDomainElement.textContent=membersDomain;
                
                // Show the sidebar
                sidebar.classList.add('show');
              });
            });

            // Retrieve the sidebar and head details elements
            const sidebar1 = document.getElementById('sidebarOffcanvas');
            const headNameElement = document.getElementById('sidebarOffcanvasHeadName');
            const headDesignationElement = document.getElementById('sidebarOffcanvasHeadDesignation');
            const headDomainElement = document.getElementById('sidebarOffcanvasHeadDomain');

            // Attach a click event listener to the "View Details" buttons
            const viewDetailsButtons1 = document.getElementsByClassName('btn btn-dark btn-view1');
            Array.from(viewDetailsButtons1).forEach(button => {
              button.addEventListener('click', () => {
            
                const headName = button.getAttribute('data-head-name');
                const headDesignation = button.getAttribute('data-head-designation');
                const headDomain = button.getAttribute('data-head-domain');

                // Update the sidebar with the head details
                headNameElement.textContent = headName;
                headDesignationElement.textContent =headDesignation;
                headDomainElement.textContent=headDomain;
                
                // Show the sidebar
                sidebar1.classList.add('show');
              });
            });
          </script>
  </body>
</html>
